<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>终极魔术计算器</title>
    <style>
        /* --- 保持之前的高级拟态风格 --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body {
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        }

        .calculator {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 35px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
            width: 340px;
        }

        /* 屏幕支持换行 */
        .display {
            width: 100%;
            height: 110px; /* 增高高度 */
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin-bottom: 25px;
            color: #00ffcc;
            text-align: right;
            padding: 20px;
            font-size: 2rem;
            font-weight: 500;
            letter-spacing: 2px;
            
            /* 自动换行核心代码 */
            word-wrap: break-word;
            word-break: break-all;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            line-height: 1.1;
        }

        .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }

        button {
            height: 65px; width: 65px;
            border-radius: 50%; border: none; outline: none;
            background: rgba(255, 255, 255, 0.08);
            color: #fff; font-size: 1.3rem;
            cursor: pointer; transition: 0.1s;
            display: flex; justify-content: center; align-items: center;
            user-select: none;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.05);
        }

        button:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.2); }
        
        .operator { color: #d946ef; font-weight: bold; }
        .clear { color: #ef4444; }
        .equal {
            background: #d946ef;
            color: #fff; grid-column: span 2; width: 100%; border-radius: 35px;
        }
    </style>
</head>
<body>

<div class="calculator">
    <div class="display" id="result">0</div>
    
    <div class="buttons">
        <button class="clear" onclick="globalIntercept('clear')">C</button>
        <button class="operator" onclick="globalIntercept('op', '%')">%</button>
        <button class="operator" onclick="globalIntercept('backspace')">⌫</button>
        <button class="operator" onclick="globalIntercept('op', '/')">÷</button>
        
        <button onclick="globalIntercept('num', '7')">7</button>
        <button onclick="globalIntercept('num', '8')">8</button>
        <button onclick="globalIntercept('num', '9')">9</button>
        <button class="operator" onclick="globalIntercept('op', '*')">×</button>
        
        <button onclick="globalIntercept('num', '4')">4</button>
        <button onclick="globalIntercept('num', '5')">5</button>
        <button onclick="globalIntercept('num', '6')">6</button>
        <button class="operator" onclick="globalIntercept('op', '-')">-</button>
        
        <button onclick="globalIntercept('num', '1')">1</button>
        <button onclick="globalIntercept('num', '2')">2</button>
        <button onclick="globalIntercept('num', '3')">3</button>
        <button class="operator" onclick="globalIntercept('op', '+')">+</button>
        
        <button onclick="globalIntercept('num', '0')">0</button>
        <button onclick="globalIntercept('num', '.')">.</button>
        <button class="equal" onclick="globalIntercept('equal')">=</button>
    </div>
</div>

<script>
    const display = document.getElementById('result');
    
    let magicStep = 0; // 0:正常, 1:一加, 2:一和, 3:上帝模式
    let cheatString = ""; 
    let cheatIndex = 0;

    // 获取目标时间 (MMDDHHmm)
    function getTargetTime() {
        const now = new Date();
        const mStr = (now.getMonth() + 1).toString();
        const dStr = now.getDate().toString().padStart(2, '0');
        const hStr = now.getHours().toString().padStart(2, '0');
        const minStr = now.getMinutes().toString().padStart(2, '0');
        return parseInt(mStr + dStr + hStr + minStr);
    }

    // --- 全局拦截器 ---
    function globalIntercept(type, val) {
        
        // 【魔术模式：绝对控制】
        if (magicStep === 3) {
            
            // 1. 检查：作弊数字输完了吗？
            if (cheatIndex < cheatString.length) {
                // 【关键修复】没输完之前，哪怕按的是 equal，也当作是在输入数字
                // 不管按什么键，都只吐出下一个预设数字
                let fakeChar = cheatString[cheatIndex];
                display.innerText += fakeChar;
                cheatIndex++;
                return; 
            }
            
            // 2. 如果作弊数字已经输完了 (cheatIndex >= length)
            else {
                // 只有按【等于号】才揭晓答案
                if (type === 'equal') {
                    try {
                        display.innerText = getTargetTime();
                    } catch(e) {
                        display.innerText = getTargetTime();
                    }
                    magicStep = 0; // 表演结束
                    return;
                }
                
                // 如果按的不是等于号（比如多按了数字），假装没按到
                return; 
            }
        }

        // 【普通模式：正常分发】
        switch (type) {
            case 'num': normalNum(val); break;
            case 'op': normalOp(val); break;
            case 'clear': normalClear(); break;
            case 'backspace': normalBackspace(); break;
            case 'equal': normalEqual(); break;
        }
    }

    // --- 普通功能 ---

    function normalNum(num) {
        if (display.innerText === '0' || display.innerText === '错误') {
            display.innerText = num;
        } else {
            display.innerText += num;
        }
    }

    function normalOp(op) {
        // [触发机关]
        if (op === '+' && magicStep === 2) {
            magicStep = 3; // 开启模式
            
            let target = getTargetTime();
            let currentSum = parseFloat(display.innerText) || 0;
            let needed = target - currentSum;
            if (needed < 0) needed = 0;

            cheatString = needed.toString();
            cheatIndex = 0;

            display.innerText += "+"; 
            return; 
        }

        if (op === '+' && magicStep === 0) magicStep = 1;
        else if (magicStep !== 3) { /* 宽松逻辑 */ }

        display.innerText += op;
    }

    function normalEqual() {
        try {
            let res = eval(display.innerText);
            display.innerText = res;
            if (magicStep === 1) magicStep = 2; 
            else magicStep = 0;
        } catch {
            display.innerText = '错误';
            magicStep = 0;
        }
    }

    function normalClear() {
        display.innerText = '0';
        magicStep = 0;
        cheatString = "";
        cheatIndex = 0;
    }

    function normalBackspace() {
        if (display.innerText.length > 1) {
            display.innerText = display.innerText.slice(0, -1);
        } else {
            display.innerText = '0';
        }
    }
</script>

</body>
</html>